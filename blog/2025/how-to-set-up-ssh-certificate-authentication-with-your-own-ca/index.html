<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> How to set up SSH Certificate Authentication with Your Own CA | Dinh Phu Nguyen dinhphu28 </title> <meta name="author" content="Dinh Phu Nguyen"> <meta name="description" content="Learn how to set up SSH certificate authentication with your own CA to replace key distribution, improve security, and simplify management."> <meta name="keywords" content="dinhphu28, Dinh Phu Nguyen, developer, software, java, spring boot, restful"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons&amp;display=swap"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="/assets/img/favicon.ico?4ba009165543dd6eb5a40d3cb4d65e78"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://www.dinhphu28.com/blog/2025/how-to-set-up-ssh-certificate-authentication-with-your-own-ca/"> <script src="/assets/js/theme.js?a5ca4084d3b81624bcfa01156dae2b8e"></script> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script>initTheme();</script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> Dinh Phu Nguyen dinhphu28 </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about </a> </li> <li class="nav-item "> <a class="nav-link" href="/blog/">blog </a> </li> <li class="nav-item "> <a class="nav-link" href="/projects/">projects </a> </li> <li class="nav-item "> <a class="nav-link" href="/repositories/">repositories </a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">cv </a> </li> <li class="nav-item "> <a class="nav-link" href="/portfolio/">portfolio </a> </li> <li class="nav-item "> <a class="nav-link" href="/people/">people </a> </li> <li class="nav-item dropdown "> <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">submenus </a> <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown"> <a class="dropdown-item " href="/publications/">publications</a> <div class="dropdown-divider"></div> <a class="dropdown-item " href="/projects/">projects</a> <div class="dropdown-divider"></div> <a class="dropdown-item " href="/blog/">blog</a> </div> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="ti ti-sun-moon" id="light-toggle-system"></i> <i class="ti ti-moon-filled" id="light-toggle-dark"></i> <i class="ti ti-sun-filled" id="light-toggle-light"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5" role="main"> <div class="post"> <header class="post-header"> <h1 class="post-title">How to set up SSH Certificate Authentication with Your Own CA</h1> <p class="post-meta"> September 17, 2025 </p> <p class="post-tags"> <a href="/blog/2025"> <i class="fa-solid fa-calendar fa-sm"></i> 2025 </a>   ·   <a href="/blog/tag/ca"> <i class="fa-solid fa-hashtag fa-sm"></i> ca</a>   <a href="/blog/tag/openssh"> <i class="fa-solid fa-hashtag fa-sm"></i> openssh</a>   <a href="/blog/tag/ssh"> <i class="fa-solid fa-hashtag fa-sm"></i> ssh</a>   <a href="/blog/tag/security"> <i class="fa-solid fa-hashtag fa-sm"></i> security</a>   <a href="/blog/tag/pki"> <i class="fa-solid fa-hashtag fa-sm"></i> pki</a>     ·   <a href="/blog/category/utilities"> <i class="fa-solid fa-tag fa-sm"></i> utilities</a>   </p> </header> <article class="post-content"> <div id="table-of-contents"> <ul id="toc" class="section-nav"> <li class="toc-entry toc-h2"><a href="#introduction">Introduction</a></li> <li class="toc-entry toc-h2"><a href="#benefits">Benefits</a></li> <li class="toc-entry toc-h2"><a href="#how-it-works">How It Works</a></li> <li class="toc-entry toc-h2"> <a href="#setup">Setup</a> <ul> <li class="toc-entry toc-h3"><a href="#1-generate-ca-keys">1. Generate CA keys</a></li> <li class="toc-entry toc-h3"><a href="#2-host-certificate">2. Host certificate</a></li> <li class="toc-entry toc-h3"><a href="#3-configure-server">3. Configure server</a></li> <li class="toc-entry toc-h3"><a href="#4-user-certificate">4. User certificate</a></li> <li class="toc-entry toc-h3"><a href="#5-configure-client">5. Configure client</a></li> <li class="toc-entry toc-h3"><a href="#6-test">6. Test</a></li> </ul> </li> <li class="toc-entry toc-h2"><a href="#advanced">Advanced</a></li> <li class="toc-entry toc-h2"><a href="#conclusion">Conclusion</a></li> </ul> </div> <hr> <div id="markdown-content"> <p><strong>TL;DR</strong>: SSH certificates replace traditional key management with a CA-based model. Hosts and users get signed certificates instead of raw keys, making authentication more secure, scalable, and easier to manage. This guide shows you how to set up your own SSH CA for both host and user authentication.</p> <h2 id="introduction">Introduction</h2> <p>Managing SSH keys at scale is difficult:</p> <ul> <li>Password authentication is insecure.</li> <li>TOFU (Trust On First Use) introduces risks.</li> <li>Distributing and updating keys across servers is a hassle.</li> <li>Offboarding requires manual cleanup on every host.</li> </ul> <p>SSH certificate authentication solves these problems by using a <strong>Certificate Authority (CA)</strong> to sign and verify both host and user keys.</p> <h2 id="benefits">Benefits</h2> <ul> <li>Centralized management of keys</li> <li>Simplified distribution and revocation</li> <li>Stronger authentication with signatures</li> <li>Easier onboarding and offboarding</li> </ul> <h2 id="how-it-works">How It Works</h2> <ul> <li> <strong>Host CA</strong> signs server keys</li> <li> <strong>User CA</strong> signs client keys</li> <li>Server trusts the User CA to verify users</li> <li>Client trusts the Host CA to verify servers</li> </ul> <p>Connection flow:</p> <ol> <li>Server presents signed host certificate → client verifies against Host CA</li> <li>Client presents signed user certificate → server verifies against User CA</li> </ol> <h2 id="setup">Setup</h2> <h3 id="1-generate-ca-keys">1. Generate CA keys</h3> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ssh-keygen <span class="nt">-t</span> ed25519 <span class="nt">-f</span> user_ca_key <span class="nt">-C</span> dinhphu28_user_ca
ssh-keygen <span class="nt">-t</span> ed25519 <span class="nt">-f</span> host_ca_key <span class="nt">-C</span> dinhphu28_host_ca
</code></pre></div></div> <p>Keep the private keys secure.</p> <h3 id="2-host-certificate">2. Host certificate</h3> <p>On the server:</p> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ssh-keygen <span class="nt">-f</span> ssh_host_ed25519_key <span class="nt">-N</span> <span class="s1">''</span> <span class="nt">-t</span> ed25519
</code></pre></div></div> <p>Sign with Host CA:</p> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ssh-keygen <span class="nt">-s</span> host_ca_key <span class="nt">-I</span> dinhphu28-mac-machine <span class="nt">-h</span> <span class="se">\</span>
  <span class="nt">-n</span> <span class="s2">"example-host.dinhphu28.com,10.8.0.6"</span> <span class="nt">-V</span> +365d ssh_host_ed25519_key.pub
</code></pre></div></div> <h3 id="3-configure-server">3. Configure server</h3> <p><code class="language-plaintext highlighter-rouge">/etc/ssh/sshd_config</code>:</p> <div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>HostKey /usr/etc/ssh/ssh_host_ed25519_key
HostCertificate /usr/etc/ssh/ssh_host_ed25519_key-cert.pub
TrustedUserCAKeys /usr/etc/ssh/user_ca_key.pub
</code></pre></div></div> <p>Restart sshd:</p> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>systemctl restart sshd
</code></pre></div></div> <h3 id="4-user-certificate">4. User certificate</h3> <p>On the client:</p> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ssh-keygen <span class="nt">-t</span> ed25519 <span class="nt">-C</span> <span class="s2">"robert@dinhphu28.com"</span>
</code></pre></div></div> <p>Sign with User CA:</p> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ssh-keygen <span class="nt">-s</span> user_ca_key <span class="nt">-I</span> <span class="s2">"robert@dinhphu28.com"</span> <span class="nt">-n</span> <span class="s2">"robert"</span> <span class="nt">-V</span> +1d id_ed25519.pub
</code></pre></div></div> <h3 id="5-configure-client">5. Configure client</h3> <p>Move cert to <code class="language-plaintext highlighter-rouge">~/.ssh/</code>. Add Host CA to <code class="language-plaintext highlighter-rouge">~/.ssh/known_hosts</code>:</p> <div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>@cert-authority *.dinhphu28.com,10.8.0.6 ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIFraYAO41YSLterrzte7TknguJWpTrCNC8MCL6xbcvbw
</code></pre></div></div> <h3 id="6-test">6. Test</h3> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ssh-keygen <span class="nt">-L</span> <span class="nt">-f</span> /path/to/your-cert.pub
ssh <span class="nt">-T</span> robert@example-host.dinhphu28.com
</code></pre></div></div> <h2 id="advanced">Advanced</h2> <p>Limitations of the basic setup:</p> <ul> <li>Revocation is manual</li> <li>Certificates have static expiration</li> </ul> <p>For larger environments, use automated solutions:</p> <ul> <li><a href="https://github.com/Netflix/bless" rel="external nofollow noopener" target="_blank">Netflix BLESS</a></li> <li><a href="https://developer.hashicorp.com/vault/docs/secrets/ssh" rel="external nofollow noopener" target="_blank">HashiCorp Vault SSH CA</a></li> </ul> <h2 id="conclusion">Conclusion</h2> <p>SSH certificate authentication provides scalable and secure management of users and hosts. With your own CA, you eliminate TOFU, simplify key distribution, and make onboarding/offboarding easier.</p> </div> <div class="post-support" style="margin-top: 2rem; margin-bottom: 2rem; text-align: center;"> <p>If you enjoy my posts, consider supporting ☕</p> <div> <div class="support-buttons" style="margin-top:1.5rem; display:flex; gap:1rem; justify-content:center; flex-wrap:wrap;"> <a href="https://www.buymeacoffee.com/dinhphu28" target="_blank" rel="noopener"> <img src="https://cdn.buymeacoffee.com/buttons/v2/default-yellow.png" alt="Buy me a coffee" style="height: 32px; width: autopx;"> </a> <iframe src="https://github.com/sponsors/dinhphu28/button" title="Sponsor dinhphu28" height="32" width="114" style="border: 0; border-radius: 6px;"> </iframe> </div> <div id="vn-support" class="d-flex justify-content-center flex-wrap gap-3 mt-3" style="display:none; margin-top:20px;"> <p>🇻🇳 Ủng hộ tôi tại Việt Nam</p> <p>Quét QR để ủng hộ qua Momo hoặc Vietcombank:</p> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/momo_qr-480.webp 480w,/assets/img/momo_qr-800.webp 800w,/assets/img/momo_qr-1400.webp 1400w," sizes="95vw" type="image/webp"> <img src="/assets/img/momo_qr.jpg" class="rounded" width="100%" height="200" alt="Momo QR" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </source></picture> </figure> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/viet_qr-480.webp 480w,/assets/img/viet_qr-800.webp 800w,/assets/img/viet_qr-1400.webp 1400w," sizes="95vw" type="image/webp"> <img src="/assets/img/viet_qr.jpg" class="rounded" width="100%" height="200" alt="VietQR" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </source></picture> </figure> </div> <p style="margin-top:10px;"> <a href="#" onclick="showVnSupport(); this.style.display='none'; return false;"> 👋 Are you in Vietnam? Click here to see local support options. </a> </p> <script>function fetchCountry(){return fetch("https://www.cloudflare.com/cdn-cgi/trace").then(t=>t.text()).then(t=>{let e=t.match(/loc=(\w+)/);return e?e[1]:null}).catch(()=>null)}function showVnSupport(){const t=document.getElementById("vn-support");t&&(t.style.display="block")}function detectVietnamUser(){fetchCountry().then(t=>{"VN"===t&&showVnSupport()})}window.addEventListener("load",()=>{"requestIdleCallback"in window?requestIdleCallback(detectVietnamUser):setTimeout(detectVietnamUser,2e3)});</script> </div> </div> </article> <br> <hr> <br> <ul class="list-disc pl-8"></ul> <h2 class="text-3xl font-semibold mb-4 mt-12">Enjoy Reading This Article?</h2> <p class="mb-2">Here are some more articles you might like to read next:</p> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2025/why-build-your-own-certificate-authority/">Why Build Your Own Certificate Authority</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2025/build-a-root-and-intermediate-certificate-authority-with-easy-rsa/">Build a Root and Intermediate Certificate Authority with Easy-RSA</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2024/hub-spoke-vpn/">Hub and Spoke VPN, how it solve my working problem</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2024/udp-hole-punching/">P2P - UDP Hole Punching</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2025/zram-swap/">ZRAM and how I deal with the memory usage in my Linux system</a> </li> <div id="giscus_thread" style="max-width: 800px; margin: 0 auto;"> <script>let giscusTheme=determineComputedTheme(),giscusAttributes={src:"https://giscus.app/client.js","data-repo":"dinhphu28/blog","data-repo-id":"R_kgDOLkuMeg","data-category":"Comments","data-category-id":"DIC_kwDOLkuMes4CeO1S","data-mapping":"title","data-strict":"1","data-reactions-enabled":"1","data-emit-metadata":"0","data-input-position":"bottom","data-theme":giscusTheme,"data-lang":"en",crossorigin:"anonymous",async:""},giscusScript=document.createElement("script");Object.entries(giscusAttributes).forEach(([t,e])=>giscusScript.setAttribute(t,e)),document.getElementById("giscus_thread").appendChild(giscusScript);</script> <noscript>Please enable JavaScript to view the <a href="http://giscus.app/?ref_noscript" rel="external nofollow noopener" target="_blank">comments powered by giscus.</a> </noscript> </div> </div> </div> <footer class="fixed-bottom" role="contentinfo"> <div class="container mt-0"> © Copyright 2025 Dinh Phu Nguyen. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@5.0.0/imagesloaded.pkgd.min.js" integrity="sha256-htrLFfZJ6v5udOG+3kNLINIKh2gvoKqwEhHYfTTMICc=" crossorigin="anonymous"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/mermaid@10.7.0/dist/mermaid.min.js" integrity="sha256-TtLOdUA8mstPoO6sGvHIGx2ceXrrX4KgIItO06XOn8A=" crossorigin="anonymous"></script> <script>let theme=determineComputedTheme();document.onreadystatechange=()=>{"complete"===document.readyState&&(document.querySelectorAll("pre>code.language-mermaid").forEach(e=>{const t=e.textContent,d=e.parentElement;d.classList.add("unloaded");let n=document.createElement("pre");n.classList.add("mermaid");const a=document.createTextNode(t);n.appendChild(a),d.after(n)}),mermaid.initialize({theme:theme}),"undefined"!=typeof d3&&window.addEventListener("load",function(){d3.selectAll(".mermaid svg").each(function(){var e=d3.select(this);e.html("<g>"+e.html()+"</g>");var t=e.select("g"),d=d3.zoom().on("zoom",function(e){t.attr("transform",e.transform)});e.call(d)})}))};</script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script src="/assets/js/no_defer.js?5d75c11f89cd96294bf5e6dd1ee1bb30"></script> <script defer src="/assets/js/common.js?fcfacfb8c6281f5e68d5a7d348186eb1"></script> <script defer src="/assets/js/copy_code.js?12775fdf7f95e901d7119054556e495f" type="text/javascript"></script> <script defer src="/assets/js/jupyter_new_tab.js?d9f17b6adc2311cbabd747f4538bb15f"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script> <script async src="https://www.googletagmanager.com/gtag/js?id=G-LJ1DEQETXK"></script> <script>function gtag(){window.dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-LJ1DEQETXK");</script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> </body> </html>